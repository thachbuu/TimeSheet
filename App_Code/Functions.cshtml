@functions {
    
    public static int getMasterUserId(){
        var db = Database.Open("StarterSite");
        var masterUserId = db.QueryValue("SELECT UserProfile.UserId FROM UserProfile,webpages_UsersInRoles AS UsersInRoles,webpages_Roles AS Roles "+  
                                         "WHERE  UserProfile.UserId = UsersInRoles.UserId AND UsersInRoles.RoleId = Roles.RoleId AND Roles.RoleName = 'MASTER'");             
        return masterUserId;
    }   

    public static List<SelectListItem> getSupervisorResources(String currentSupervisorEmail=null,Boolean includeDefaultValue=true){
        /**
            This function will create a list of Supervisor emails but not include the ignoredEmail.
        **/

        var db = Database.Open("StarterSite");
        var supervisorQuery = "SELECT Email,UserProfile.UserId " + 
                          "FROM   UserProfile, webpages_UsersInRoles AS UsersInRoles, webpages_Roles AS Roles " +  
                          "WHERE  UserProfile.UserId=UsersInRoles.UserId AND UsersInRoles.RoleId=Roles.RoleId And Roles.RoleName='LEADER'";
        
        var supervisorData = db.Query(supervisorQuery);    
        var supervisorList = new List<SelectListItem>();

        var defaultItem = new SelectListItem(){Text = "---- Select Owner ----", Value = getMasterUserId().ToString(), Selected = (currentSupervisorEmail != null?true:false)};
        if(includeDefaultValue){supervisorList.Add(defaultItem);}
    
        foreach(var item in supervisorData ){                        
                var person = new SelectListItem();
                person.Text = item.Email;
                person.Value = item.UserId.ToString();        
                if(item.Email == currentSupervisorEmail){
                    person.Selected = true;
                }else{
                    person.Selected = false;                   
                }
                supervisorList.Add(person);            
        }
        return supervisorList;        
    }       
}